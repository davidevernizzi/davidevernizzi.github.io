<!DOCTYPE html>
<html>
	<head>
	
	<link href="//gmpg.org/xfn/11" rel="profile">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<link rel="canonical" href="https://davidevernizzi.github.io//blog/how-to-import-lots-of-rows-everyday" />
	<meta name="description" content="Let’s say you have a lot of data to import. Let’s say you don’t want to do it everyday without..." />
	<meta property="og:description" content="Let’s say you have a lot of data to import. Let’s say you don’t want to do it everyday without..." />
	<meta itemprop="image" content="https://davidevernizzi.github.io//assets/images/icon.png" />
	<meta property="og:image" content="https://davidevernizzi.github.io//assets/images/icon.png" />
	<meta property="og:title" content="How to import lots of rows on MySql" />
	<meta property="og:type" content="article" />
	<meta property="og:url" content="https://davidevernizzi.github.io//blog/how-to-import-lots-of-rows-everyday" />
	<meta property="og:site_name" content="Thinny" />
	<title>How to import lots of rows on MySql &middot; Thinny</title>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" media="only screen and (min-width: 900px)" href="/assets/css/desktop.css" />
	<link rel="stylesheet" type="text/css" media="only screen and (max-width: 899px)" href="/assets/css/mobile.css" />
	<link href="/assets/css/genericons.css" type="text/css" rel="stylesheet" />
	<link href="/assets/css/syntax.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fenix:400,400italic">
	<link rel="apple-touch-icon" href="https://davidevernizzi.github.io//assets/images/icon.png">
	<link rel="shortcut icon" href="https://davidevernizzi.github.io//assets/images/favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="https://davidevernizzi.github.io//atom.xml">
	<script type="text/javascript" src="/assets/js/jquery-2.1.0.min.js"></script>
	<script type="text/javascript" src="/assets/js/jquery.stellar.min.js"></script>
	
</head>

	<body>
		<header class="clean" style="background-image: url(/assets/images/cover.jpg); height: 100%;" data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50">
	
	<label class="menu" for="_1">
	<span class="genericon genericon-menu"></span>
</label>
<input id="_1" type="checkbox">
<div class="menu-content">
	<p class="menu-title">Thinny<p>
	<div class="menu" style="background-color: #1a1a1a; z-index: -1;"></div>
	
		<a href="/">Home</a>
	
		<a href="/about">About</a>
	
	<hr>
	
		<a href="https://twitter.com/davide_vernizzi" class="social-links-menu" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a>
	
		<a href="https://github.com/davidevernizzi" class="social-links-menu" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
	
</div>
<div class="social-links" data-stellar-ratio="0.1">
	
		<a href="https://twitter.com/davide_vernizzi" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a>
	
		<a href="https://github.com/davidevernizzi" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
	
</div>

	<div id="post-info" data-stellar-ratio="0.7">
		<h1>How to import lots of rows on MySql</h1>
		
		<a class="site-title" href="https://davidevernizzi.github.io/"><div class="site-icon-small" style="background-image: url(/assets/images/icon.png);"></div>Thinny</a>, in 18 November 2014
	</div>
	
	<div id="nav-icon" style="bottom: 30px;" data-stellar-ratio="4">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-expand"></span></a>
	</div>
</header>
<div id="middle">
	<div id="article">
		<p>Let’s say you have a lot of data to import. Let’s say you don’t want to do it everyday without any downtime. Here is how I do this.</p>

<p>As an example, I will use a table that contains the customer base. Let’s call it <code>tbl_customer</code>.</p>

<ul>
<li>Import with <code>mysqlimport</code> to a staging table, we will call it <code>tbl_customer_import</code>. It is easier to keep on the staging table the same structure that the original data, even if our <code>tbl_customer</code> will have a different schema.</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">$ mysqlimport --delete --lines-terminated-by=&#39;\r\n&#39; --ignore-lines=1 --compress -h DB_SERVER -u DB_USER -p tbl_name.csv
</code></pre></div>
<ul>
<li><p>It you are importing to Amazon RDS databases, you alsa have to use the <code>local</code> switch.</p></li>
<li><p>Mark rows to delete and delete them</p></li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">/* Mark to delete */
update prod_table
set to_keep=0;

update prod_table t, stage_table s
set t.to_keep=1
where t.field=s.fiels;

/* Actually delete them */
delete from prod_table
where to_keep=0;
</code></pre></div>
<ul>
<li>Update modified rows</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">update tbl_customer c, tbl_customer_import i
set
c.phone_number=i.phone_number,
c.mobile_number=i.mobile_number,
/*
 upadte other fields
 */
where c.customer_id = i.customer_id;
</code></pre></div>
<ul>
<li>Insert new rows</li>
</ul>
<div class="highlight"><pre><code class="language-text" data-lang="text">insert ignore into tbl_customer (
   customer_id,
   phone_number,
   mobile_number,
   /*
    Other fields
    */
)
select
   customer_id,
   phone_number,
   mobile_number,
   /*
    Other fields
    */
from tbl_customer_import;
</code></pre></div>
<p>That&#39;s it.</p>

	</div>
	
	<div id="comments">
		
	
	<script src="https://apis.google.com/js/plusone.js"></script>
	<div id="g-comments" class="g-comments" data-href="https://davidevernizzi.github.io//blog/how-to-import-lots-of-rows-everyday" data-width="700" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD"></div>
	<script>
		var width = $('#comments').width() * 0.9;
		width = Math.round(width);
		$("#g-comments").attr({ "data-width": width });
	</script>


	</div>
	
</div>

	
	
	
	
	
	

<footer class="clean" style="background-image: url(/assets/images/cover.jpg); height: 75%; min-height: 500px;" data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50" data-stellar-vertical-offset="50">
	<div id="nav-icon" style="top: 60px;" data-stellar-ratio="0.8">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-collapse"></span></a>
	</div>
	<div id="post-info" data-stellar-ratio="0.5" data-stellar-vertical-offset="120">
		<h3>Read next</h3>
		<a href="/blog/aws-elastic-beanstalk-and-sugarcrm">
			<h1>AWS Elastic Beanstalk and SugarCRM</h1>
			
				<h2></h2>
			
		</a>
	</div>
	<p class="copyright">&copy;2014, <a href="https://davidevernizzi.github.io" target="_blank">Dave</a>. <a href="http://creativecommons.org/licenses/by-nc/2.5" target="_blank">Some rights reserved</a>.</p>
</footer>
<script src="/assets/js/smooth-scroll.js"></script>

		<script>
		var width = $(window).width()
		if ( width > 899 )
		$( function(){
		    $.stellar({
		    	responsive: true,
			verticalScrolling: true,
			horizontalOffset: 0,
			verticalOffset: 0,
			positionProperty: 'transform',
		    });
		});
		</script>
	</body>
</html>
